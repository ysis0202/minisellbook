# 저축 기능 추가 - DB 스키마 적용 가이드

## 📋 변경 사항 요약

이 업데이트는 장부 앱에 **저축** 기능을 추가합니다.

### 주요 변경 사항
- ✅ 수입/지출에 **저축** 타입 추가
- ✅ 순잔액 계산식 변경: `수입 - 지출 - 저축`
- ✅ 저축 목표 관리 기능
- ✅ 모든 UI에서 저축 항목 파란색으로 구분 표시

---

## 🗄️ DB 스키마 적용

### 방법 1: Supabase Dashboard 사용 (추천)

1. **Supabase 대시보드 접속**
   - https://supabase.com 로그인
   - 프로젝트 선택

2. **SQL Editor 열기**
   - 좌측 메뉴에서 `SQL Editor` 클릭

3. **스키마 파일 실행**
   - `minicellbook/supabase/schema.sql` 파일 전체 내용 복사
   - SQL Editor에 붙여넣기
   - `Run` 버튼 클릭

4. **완료 확인**
   - 에러 없이 실행되면 완료!
   - `Success. No rows returned` 메시지가 표시됩니다.

---

### 방법 2: Supabase CLI 사용

```bash
# 1. Supabase CLI 로그인 (이미 했다면 생략)
npx supabase login

# 2. 프로젝트 연결 (이미 했다면 생략)
npx supabase link --project-ref YOUR_PROJECT_REF

# 3. 스키마 적용
npx supabase db push
```

---

## ✅ 적용 확인 방법

### 1. 테이블 확인
Supabase Dashboard → Table Editor에서 다음 확인:

- **categories 테이블**: `kind` 컬럼에 'savings' 값이 있는지 확인
- **entries 테이블**: `kind` 컬럼에 'savings' 값이 있는지 확인
- **savings_goals 테이블**: 새로 생성되었는지 확인

### 2. 함수 확인
SQL Editor에서 실행:

```sql
-- 온보딩 함수에 저축 카테고리가 포함되어 있는지 확인
SELECT * FROM categories WHERE kind = 'savings' LIMIT 1;
```

---

## 🧪 테스트 방법

### 1. 개발 서버 실행

```bash
cd minicellbook
npm run dev
```

### 2. 테스트 시나리오

1. **새 사용자 온보딩**
   - 회원가입 후 카테고리 확인
   - "저축" 카테고리가 자동 생성되는지 확인 (💰 이모지)

2. **저축 항목 추가**
   - 홈 화면에서 + 버튼 클릭
   - "저축" 버튼 클릭 (파란색)
   - 금액 입력 후 저장
   - 항목이 파란색으로 표시되는지 확인

3. **요약 확인**
   - 홈 상단: 수입/지출/저축 3칸 + 순잔액 표시 확인
   - 통계 페이지: 총 저축 카드 확인
   - 연간 요약: 각 월에 저축 표시 확인

4. **저축 목표 설정**
   - 통계 페이지 → 저축 목표 "설정" 버튼
   - 목표 금액 입력
   - 진행률 표시 확인

---

## 🎨 UI 변경 사항

### 홈 화면 (TopSummary)
```
┌─────────────────────────┐
│ 수입    지출    저축     │
│ +2M    -1M    -500K     │
└─────────────────────────┘
┌─────────────────────────┐
│ 순잔액: +500K          │
└─────────────────────────┘
```

### 항목 추가 모달
```
┌─────────────────────────┐
│  수입  │  지출  │  저축  │
│ (초록) │ (빨강) │ (파랑) │
└─────────────────────────┘
```

### 통계 페이지
```
┌──────┬──────┬──────┐
│총수입│총지출│총저축│
└──────┴──────┴──────┘
┌─────────────────────┐
│ 순잔액: 수입-지출-저축│
└─────────────────────┘
```

---

## 📊 계산 로직

```typescript
// 기존
순잔액 = 수입 - 지출

// 변경 후
순잔액 = 수입 - 지출 - 저축

// 예시
수입: 3,000,000원
지출: 2,000,000원
저축: 500,000원
------------------
순잔액: 500,000원  ✅
```

---

## 🔧 트러블슈팅

### Q: 스키마 적용 시 에러 발생
**A:** 기존 데이터와 충돌할 수 있습니다.
```sql
-- 기존 entries 테이블의 kind 값 확인
SELECT DISTINCT kind FROM entries;

-- 만약 다른 값이 있다면 수동으로 변경 필요
```

### Q: 저축 카테고리가 자동 생성되지 않음
**A:** 온보딩 함수가 제대로 적용되지 않았을 수 있습니다.
```sql
-- 수동으로 저축 카테고리 생성
INSERT INTO categories (user_id, name, kind, emoji, sort)
VALUES (auth.uid(), '저축', 'savings', '💰', 1);
```

### Q: 이미 가입한 사용자는?
**A:** 기존 사용자에게 저축 카테고리 추가:
```sql
-- 모든 사용자에게 저축 카테고리 추가
INSERT INTO categories (user_id, name, kind, emoji, sort)
SELECT id, '저축', 'savings', '💰', 1
FROM auth.users
WHERE NOT EXISTS (
  SELECT 1 FROM categories 
  WHERE categories.user_id = auth.users.id 
  AND categories.kind = 'savings'
);
```

---

## 📝 다음 단계 (선택사항)

1. **저축 목표 알림 기능** (향후 구현)
   - 매월 28일 저축 목표 달성 여부 알림
   - 미달 시 추가 저축 권장

2. **저축 카테고리 세분화**
   - 긴급 예비금
   - 목돈 마련
   - 투자 자금 등

3. **통계 차트 추가**
   - 월별 저축 추이 그래프
   - 저축률 분석

---

## 🎉 완료!

모든 작업이 완료되었습니다! 
저축 기능을 활용해서 체계적인 재정 관리를 시작하세요! 💰

---

**문제가 있다면:**
- schema.sql 파일 확인
- Supabase 대시보드에서 로그 확인
- 브라우저 콘솔에서 에러 메시지 확인

